<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="fontAwesome/css/font-awesome.css"/>
	<link rel="stylesheet" type="text/css" href="font/iconfont.css">
	<style type="text/css">
		body,ul,ol,li,h1,h2,h3,p {
			margin: 0;
			padding: 0;
		}
		ul,ol,li {
			list-style: none;
		}
		body {
			background: #282828;
			user-select:none;
		}
		#top {
			width: 600px;
			height: 260px;
			background: white;
			margin: 100px auto 0;
			padding: 20px 30px 0 20px;
			position: relative;
		}
		#bottom {
			width: 620px;
			height: 40px;
			background: white;
			margin: 0 auto 0;
			padding: 5px 10px 0 20px;
		}
		#player {
			width: 250px;
			height: 260px;
			float: left;
		}
		.musicName,.singer {
			width: 100%;
			text-align: center;
		}
		.icon {
			width: 120px;
			height: 120px;
			margin: 20px auto;
			border-radius: 25%;
		}
		.icon img {
			border-radius: 25%;
		}
		p {
			width: 100%;
			text-align: center;
		}
		p span {
			margin: 0 15px;
		}
		#txt {
			width: 350px;
			height: 260px;
			float: left;
		}
		#list {
			width: 100%;
			height: 100%;
		}
		#list li {
			width: 310px;
			height: 30px;
			padding: 0 20px;
			line-height: 30px;
		}
		#list li:hover {
			background: #333333;
			cursor: pointer;
		}
		.li1 {
			float: left;
		}
		.li2 {
			float: right;
		}
		#lyric {
			overflow: hidden;
			width: 0;
			height: 0;
		}
		#controlBar {
			width: 5px;
			height: 100px;
			background: red;
			position: absolute;
			bottom: 0;
			left: 35px;
		}		
		#small {
			width: 5px;
			height: 52px;
			background: gray;
		}
		#controlVolume {
			width: 15px;
			height: 8px;
			background:skyblue;
			position: absolute;
			bottom: 48px;
			left: -5px; 
		}
		#bottom .schedule1 {
			width: 300px;
			height: 5px;
			margin-top: 5px;
			background: #666;
			margin-left: 0px;
			margin-right: 0px;
		}
		.schedule1:hover,.schedule2:hover,#controlBar:hover,
		#lyricShow:hover,#spanHeart:hover {
			cursor: pointer;
		}
		#bottom .schedule2 {
			width: 0;
			height: 5px;
			background:red;
			margin-left: 0px;
			margin-right: 0px;
		}
		#circulate {
			width: 16px;
			height: 16px;
		}
		#lyricShow {
			width: 18px;
			height: 18px;
			border-radius: 50%;
			font-size: 12px;
			text-align: center;
			line-height: 18px;
			color: white;
			background: red;
		}
		#bottom	span,#bottom div {
			float: left;
			margin-left: 10px;
			margin-right: 10px;
		}
		#spanHeart {
			color: gray;
			margin-top: 2px;
		}
		#controlText {
			margin-top: -3px;
		}
	</style>
</head>
<body>
	<audio src="" id="play"></audio>	
	<div id="top">
		<div id="player">
			<h1 class="musicName"></h1>
			<div class="singer"></div>
			<div class="icon">
                <img src="">
            </div>
			<p>
				<span class="fa fa-backward" id="spanBack"></span>
				<span class="fa fa-play" id="spanPlay"></span>
				<span class="fa fa-forward" id="spanFront"></span>
			</p>
		</div>
		<div id="txt">
			<ul id="list">
                
            </ul>
			<!-- <div id="lyric">
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
				<p>我是一个大帅哥！我是一个大帅哥！</p>
			</div> -->
		</div>
		<div id="controlBar" style="display: none;">
			<div id="controlVolume"></div>
			<div id="small"></div>
		</div>
	</div>
	<div id="bottom">
		<span class="fa fa-volume-up" id="volShow"></span>
		<span class="iconfont icon-liebiaoxunhuan" id="circulate"></span>
		<div class="schedule1">
			<div class="schedule2"></div>
		</div>
		<div id="controlText"></div>
		<!-- <div id="lyricShow">词</div> -->
		<span class="fa fa-heart" id="spanHeart"></span>
	</div>
</body>
</html>
<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript">
	var music_list =[
		{
			"id": "0",
			"name": "多幸运",
			"singer": "李承杰",
			"duration": "04:09",
			"src": "media/李承洁 - 多幸运.mp3",
			"images": "img/5.jpg"
		},
		{
			"id": "1",
			"name": "刚好遇见你",
			"singer": "李玉刚",
			"duration": "03:19",
			"src": "media/李玉刚 - 刚好遇见你.mp3",
			"images": "img/4.png"
		},		
		{
			"id": "2",
			"name": "微信爱",
			"singer": "微信爱",
			"duration": "04:05",
			"src": "media/微信爱.mp3",
			"images": "img/6.jpg"
		},	
		{
			"id": "3",
			"name": "遇见你是我的缘",
			"singer": "央金",
			"duration": "04:43",
			"src": "media/央金 - 遇见你是我的缘.mp3",
			"images": "img/3.jpg"
		},	
		{
			"id": "4",
			"name": "逆流成河",
			"singer": "金南玲",
			"duration": "00:32",
			"src": "media/金南玲-逆流成河.mp3",
			"images": "img/2.jpg"
		}	
	];
	// 获取dom节点
	var play = document.getElementById("play"); // audio标签
	play.index = 0;
	play.volume = 0.5;
	var list = document.getElementsByTagName("ul")[0]; // 播放列表
    var lis = []; // 歌曲列表
	// var lyric = document.getElementById("lyric"); // 歌词
	var icon = document.getElementsByClassName("icon")[0].firstElementChild; // 歌手头像
	var musicName = document.getElementsByClassName("musicName")[0]; // 歌曲名
	var singer = document.getElementsByClassName("singer")[0]; // 歌手名
	var spanPlay = document.getElementById("spanPlay"); // 播放按钮
	var spanBack = document.getElementById("spanBack"); // 上一首
	var spanFront = document.getElementById("spanFront"); // 下一首
	var controlText=document.getElementById("controlText"); // 播放了多少了
	var schedule2 = document.getElementsByClassName("schedule2")[0]; // 音乐进度条(已播放)
	var schedule1 = document.getElementsByClassName("schedule1")[0]; // 音乐进度条(未播放)
	var volShow = document.getElementById("volShow"); // 音量提示标(小喇叭)
	var spanHeart = document.getElementById("spanHeart"); // 收藏歌曲
	// var lyricShow = document.getElementById("lyricShow");
	var circulate = document.getElementById("circulate"); // 切换播放模式
	var controlVolume = document.getElementById("controlVolume"); // 音量条上的拖动按钮
	var controlBar = document.getElementById("controlBar"); // 音量条(音量已到达部分)
	var small = document.getElementById("small"); // 音量条(音量未到达部分)
	var top1 = document.getElementById("top");
	// 初始化歌曲信息，监听歌曲时长，监听播放多久了。	
	icon.src = music_list[0].images;	
	musicName.innerHTML = music_list[0].name;
	singer.innerHTML = music_list[0].singer;
	play.src = music_list[0].src;
	/*setInterval(function(){
		var a=play.duration;
		console.log(a);
	},1000);在定时器里可以查看歌曲的总时长*/
	setInterval(function () {
		controlText.innerHTML = formatTime(play.currentTime) + "/" + formatTime(play.duration);
	}, 0);
	// 动态获取播放列表，点击播放列表切换歌曲.
	for (var i = 0; i < music_list.length; i ++) {
		var music = music_list[i];
		var li = document.createElement("li");
		li.index = music_list[i].id;
		var span1 = document.createElement("span");
		span1.innerHTML = music.name;
		span1.className = "li1";
		var span2 = document.createElement("span");
		span2.innerHTML = music.duration;
		span2.className = "li2";
		li.appendChild(span1);
		li.appendChild(span2);
		list.appendChild(li);
		lis = list.getElementsByTagName("li");
		lis[0].style.color = "red";	
		li.onclick = function () {
			play.index = this.index;
			this.style.color = "red";
			$(this).siblings().css("color", "black");
			getMusic(this.index);
		}
	}
	// 开始按钮与暂停按钮	
	spanPlay.onmousedown = function () {
		this.style.color = "#5f5f5f";
		if (play.paused) {
			play.play();
			spanPlay.className="fa fa-pause";
		} else {
			play.pause();
			spanPlay.className="fa fa-play";
		}
	}
	spanPlay.onmouseup = function () {
		this.style.color = "black";
	}
	// 上一首
	spanBack.onmousedown = function () {
		this.style.color = "#5f5f5f";
		play.index--;
		if (play.index == -1) {
			play.index = music_list.length - 1;
		}
		lis[play.index].style.color = "red";
		$(lis[play.index]).siblings().css("color", "black");
		getMusic(play.index);
	}
	spanBack.onmouseup = function () {
		this.style.color = "black";
	}
	// 下一首
	spanFront.onmousedown = function () {
		this.style.color = "#5f5f5f";
		play.index ++;
		if (play.index == music_list.length) {
			play.index = 0;
		}
		lis[play.index].style.color = "red";
		$(lis[play.index]).siblings().css("color", "black");
		getMusic(play.index);	
	}
	spanFront.onmouseup = function () {
		this.style.color = "black";
	}
	// 点击调出音量条
	volShow.onclick = function () {
		if (controlBar.style.display == 'none') {
			controlBar.style.display = 'block';
		} else {
			controlBar.style.display = 'none';
		}
	}
	// 拖动音量条控制音量
	controlVolume.onmousedown = function (event) {
		var y = event.clientY - this.offsetTop;
		document.onmousemove = function (event) {
			var a = event.clientY - y;		
			if (a >= controlBar.offsetHeight - controlVolume.offsetHeight) {
				a = controlBar.offsetHeight - controlVolume.offsetHeight;
			} else if (a <= 0) {
				a = 0;
			}
			controlVolume.style.top = a + "px";
			small.style.height = a + "px";
			var percent = 1 - (small.offsetHeight / (controlBar.offsetHeight - controlVolume.offsetHeight));
			play.volume = percent;
		}
	}
	document.onmouseup = function () {
		document.onmousemove = null;
	}
	// 点击音量条控制音量
	controlBar.onclick = function (eve) {
		var e = eve || window.event;
		var a = this.offsetTop + top1.offsetTop;
		controlVolume.style.top = e.clientY - a + "px";
		small.style.height = e.clientY - a + "px";
		var percent = 1 - (small.offsetHeight / (controlBar.offsetHeight - controlVolume.offsetHeight));
		play.volume = percent;
	}
	// 控制音乐播放进度
	setInterval(function () {		
		var percent = play.currentTime / play.duration;
		schedule2.style.width = percent * (schedule1.offsetWidth) + "px";
		/* 不在定时器里监听不出来play.duration的值 */
	}, 0);
	schedule1.onclick = function (eve) {
		var event = eve || window.event;			
		var percent = (event.clientX - this.offsetLeft) / this.offsetWidth;
		play.currentTime = (play.duration) * percent;		
	}
	/* // 隐藏和显示播放列表
	lyricShow.onclick = function () {
		if (list.style.display != "none") {			
			list.style.display = "none";
			this.innerHTML = "曲";
			lyric.style.width = "350px";
			lyric.style.height = "260px";
		} else {
			list.style.display = "block";
			this.innerHTML = "词";
			lyric.style.width = "0";
			lyric.style.height = "0";
		}
	} */
	// 收藏当前歌曲到sessionStorage
	spanHeart.onclick = function () {
		var a = music_list[play.index].name;
		if (sessionStorage[a]) {
			sessionStorage.removeItem(a);
		} else {
			sessionStorage[a] = true;
		}
	}
	setInterval(function () {
		if (sessionStorage[music_list[play.index].name]) {
			spanHeart.style.color = "red";
		} else {
			spanHeart.style.color = "gray";
		}
	}, 0);
	// 声明一个包含所有播放模式的类名的数组
	var classArr = ["fa fa-random", "iconfont icon-single", "iconfont icon-shunxubofang", "iconfont icon-liebiaoxunhuan"];
	// 默认播放模式为单曲循环
	circulate.className = classArr[1];
	play.loop = "loop";
	// 点击切换播放模式		
	var i = 1;
	circulate.onclick = function () {
		i ++;
		if (i == 4) {
			i = 0;
		}
		circulate.className = classArr[i];
		if (classArr.indexOf(circulate.className) == 0) { // 随机播放
			play.removeAttribute("loop");
			play.onended = function () {
				play.index = parseInt(Math.random() * lis.length);
				lis[play.index].style.color = "red";
				$(lis[play.index]).siblings().css("color","black");
				getMusic(play.index);
			}
		} else if(classArr.indexOf(circulate.className) == 1) { // 单曲循环
			play.loop = "loop";
		} else if(classArr.indexOf(circulate.className) == 2) { // 顺序播放
			play.removeAttribute("loop");
			play.onended = function () {
				play.index ++;
				if (play.index == lis.length) {
					play.index --;
					spanPlay.className = "fa fa-play";
				} else {
					lis[play.index].style.color = "red";
					$(lis[play.index]).siblings().css("color","black");
					getMusic(play.index);
				}			
			}	
		} else if (classArr.indexOf(circulate.className) == 3) { // 列表循环
			play.removeAttribute("loop");
			play.onended = function () {
				play.index ++;
				if (play.index == lis.length) {
					play.index = 0;
				}
				lis[play.index].style.color = "red";
				$(lis[play.index]).siblings().css("color","black");
				getMusic(play.index);
			}
		}		
	}	
	// 获取音乐信息并播放	
	function getMusic(a) {
		icon.src = music_list[a].images;
		musicName.innerHTML = music_list[a].name;
		singer.innerHTML = music_list[a].singer;
		play.src = music_list[a].src;
		play.play();
		spanPlay.className = "fa fa-pause";
	}
	// 时间按正确的格式显示
	function formatTime(time) {
		if (time >= 3600) {
			var s = parseInt(time % 60);
			var m = parseInt(time % 3600/60);
			var h = parseInt(time / 3600);
			var s1 = s >= 10 ? s : "0" + s;
			var m1 = m >= 10 ? m : "0" + m;
			var h1 = h >= 10 ? h : "0" + h;
			return h1 + ":" + m1 + ":" + s1;
		} else if (time >= 60) {
			var s = parseInt(time % 60);
			var m = parseInt(time / 60);
			var s1 = s >= 10 ? s : "0" + s;
			var m1 = m >= 10 ? m : "0" + m;
			return m1 + ":" + s1;
		} else if (time < 60 && time >= 0) {
			var s = time >= 10 ? parseInt(time) : "0" + parseInt(time);
			return "00:" + s;
		}
	}
</script>